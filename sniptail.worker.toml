# Sniptail worker configuration
# All values can be overridden by environment variables.
# Comments note: default value, whether optional, and an example.

[core]
# Path to the repo allowlist JSON file.
# Optional. No default. Example: "$HOME/.sniptail/allowlist.json"
# When set, worker startup can seed an empty registry catalog from this file.
repo_allowlist_path = "$HOME/.sniptail/allowlist.json"

# Path to the job working root.
# Required. No default. Example: "$HOME/.sniptail/jobs"
job_work_root = "$HOME/.sniptail/jobs"

# Path to the job registry file/directory (used for sqlite).
# Required when job_registry_db="sqlite". Ignored for "pg" and "redis". No default. Example: "$HOME/.sniptail/job-registry"
job_registry_path = "$HOME/.sniptail/job-registry"

# Registry backend: "sqlite", "pg", or "redis".
# Optional. Default: "redis". Example: "redis"
job_registry_db = "redis"

# When job_registry_db is "pg", set JOB_REGISTRY_PG_URL in env.
# Optional. No default. Example: "postgres://user:pass@host:5432/db"
# job_registry_pg_url is read from env only.

# When job_registry_db is "redis", configure this or set JOB_REGISTRY_REDIS_URL/REDIS_URL.
# Optional. No default. Example: "redis://localhost:6379/1"
# job_registry_redis_url = "redis://localhost:6379/1"

[worker]
# Friendly bot name shown in UIs.
# Optional. Default: "Sniptail". Example: "Sniptail Worker"
bot_name = "Sniptail"

# Primary agent for jobs: "codex" or "copilot".
# Optional. Default: "codex". Example: "copilot"
primary_agent = "codex"

# Redis connection URL.
# Required. No default. Example: "redis://localhost:6379"
redis_url = "redis://localhost:6379"

# Main job worker concurrency for queue "sniptail-jobs".
# Optional. Default: 2. Example: 4
# job_concurrency = 2

# Bootstrap request worker concurrency for queue "sniptail-bootstrap".
# Optional. Default: 2. Example: 2
# bootstrap_concurrency = 2

# Worker-event concurrency for queue "sniptail-worker-events".
# Optional. Default: 2. Example: 4
# worker_event_concurrency = 2

# Root directory for cached repos.
# Required. No default. Example: "$HOME/.sniptail/repo-cache"
repo_cache_root = "$HOME/.sniptail/repo-cache"

# Root directory for local repo bootstraps. When set, local paths must be relative
# to this root.
# Optional. No default. Example: "$HOME/.sniptail/local-repos"
# local_repo_root = "$HOME/.sniptail/local-repos"

# Optional glob of paths to copy into each job root.
# Optional. No default. Example: "$HOME/.sniptail/common/**"
# job_root_copy_glob = "$HOME/.sniptail/common/**"

# Cleanup jobs past a max age (duration string like "30m", "12h", "7d").
# Optional. No default. Example: "7d"
# cleanup_max_age = "7d"

# Keep only the most recent N jobs in history; older entries are eligible for cleanup.
# Optional. No default. Example: 20
# cleanup_max_entries = 20

# Include raw user request in MR/PR descriptions.
# Optional. Default: false. Example: true
# include_raw_request_in_mr = false

# Optional command executed in each prepared repo worktree.
# Runs before an optional repo-local ".sniptail/setup" contract script.
# Optional. No default. Example: "pnpm install --prefer-offline --no-lockfile"
# worktree_setup_command = "pnpm install --prefer-offline --no-lockfile"

# If true, continue jobs even when worktree_setup_command exits non-zero.
# Optional. Default: false. Example: true
# worktree_setup_allow_failure = false

[copilot]
# Execution mode for GitHub Copilot agent.
# Optional. Default: "local". Example: "docker"
execution_mode = "local"

# Idle retry count for Copilot agent.
# Optional. Default: 2. Example: 3
idle_retries = 2

# Dockerfile path for Copilot execution (if execution_mode = "docker").
# Optional. Default: "../../Dockerfile.copilot". Example: "../../Dockerfile.copilot"
# dockerfile_path = "../../Dockerfile.copilot"

# Docker image name for Copilot execution (if execution_mode = "docker").
# Optional. Default: "snatch-copilot:local". Example: "snatch-copilot:local"
# docker_image = "snatch-copilot:local"

# Docker build context for Copilot execution (if execution_mode = "docker").
# Optional. No default. Example: "."
# docker_build_context = "."

[copilot.models]
# Optional per-command model overrides.
# Keys: ASK, IMPLEMENT, PLAN, REVIEW, MENTION.
# Each entry is a table with:
# - model (required): model identifier
# - model_reasoning_effort (optional): minimal | low | medium | high | xhigh
#
# [copilot.models.ASK]
# model = "gpt-5-mini"
# model_reasoning_effort = "low"
#
# [copilot.models.IMPLEMENT]
# model = "gpt-5"

[codex]
# Execution mode for OpenAI Codex agent.
# Optional. Default: "local". Example: "docker"
execution_mode = "local"

# Dockerfile path for Codex execution (if execution_mode = "docker").
# Optional. Default: "../../Dockerfile.codex". Example: "../../Dockerfile.codex"
# dockerfile_path = "../../Dockerfile.codex"

# Docker image name for Codex execution (if execution_mode = "docker").
# Optional. Default: "snatch-codex:local". Example: "snatch-codex:local"
# docker_image = "snatch-codex:local"

# Docker build context for Codex execution (if execution_mode = "docker").
# Optional. No default. Example: "."
# docker_build_context = "."

[codex.models]
# Optional per-command model overrides.
# Keys: ASK, IMPLEMENT, PLAN, REVIEW, MENTION.
# Each entry is a table with:
# - model (required): model identifier
# - model_reasoning_effort (optional): minimal | low | medium | high | xhigh
#
# [codex.models.ASK]
# model = "gpt-5-mini"
# model_reasoning_effort = "medium"
#
# [codex.models.IMPLEMENT]
# model = "gpt-5"

[github]
# GitHub API base URL.
# Optional. Default: "https://api.github.com". Example: "https://api.github.com"
# Requires GITHUB_API_TOKEN in env to be enabled.
# api_base_url = "https://api.github.com"

[gitlab]
# GitLab base URL.
# Optional. No default. Example: "https://gitlab.com"
# Requires GITLAB_TOKEN in env when set.
# base_url = "https://gitlab.com"

# OpenAI API key is read from env only: OPENAI_API_KEY (used for Codex when set).
# Repo allowlist token paths are also read from env where applicable.
