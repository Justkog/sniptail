# Sniptail bot configuration
# All values can be overridden by environment variables.
# Comments note: default value, whether optional, and an example.

[core]
# Path to the repo allowlist JSON file.
# Optional. No default. Example: "$HOME/.sniptail/allowlist.json"
# The bot reads repositories from the configured registry catalog; this file is only used if you run manual sync tooling.
repo_allowlist_path = "$HOME/.sniptail/allowlist.json"

# Path to the job working root.
# Required. No default. Example: "$HOME/.sniptail/jobs"
job_work_root = "$HOME/.sniptail/jobs"

# Queue transport driver: "redis" or "inproc".
# Optional. Default: "redis". Use "inproc" with `sniptail local` only.
queue_driver = "redis"

# Path to the job registry file/directory (used for sqlite).
# Required when job_registry_db="sqlite". Ignored for "pg" and "redis". No default. Example: "$HOME/.sniptail/job-registry"
job_registry_path = "$HOME/.sniptail/job-registry"

# Registry backend: "sqlite", "pg", or "redis".
# Optional. Default: "redis". Example: "redis"
job_registry_db = "redis"

# When job_registry_db is "pg", set JOB_REGISTRY_PG_URL in env.
# Optional. No default. Example: "postgres://user:pass@host:5432/db"
# job_registry_pg_url is read from env only.

# When job_registry_db is "redis", configure this or set JOB_REGISTRY_REDIS_URL/REDIS_URL.
# Optional. No default. Example: "redis://localhost:6379/1"
# job_registry_redis_url = "redis://localhost:6379/1"

[bot]
# Friendly bot name shown in UIs.
# Optional. Default: "Sniptail". Example: "Sniptail Staging"
bot_name = "Sniptail"

# Primary agent for jobs: "codex" or "copilot".
# Optional. Default: "codex". Example: "copilot"
primary_agent = "codex"

# Include extra debug job spec messages in Slack.
# Optional. Default: false. Example: true
# debug_job_spec_messages = false

# Services available for bootstrap operations.
# Optional. Default: [] (empty). Example: ["local", "github", "gitlab"]
# bootstrap_services = ["local", "github"]

# Redis connection URL.
# Required when queue_driver="redis". No default. Example: "redis://localhost:6379"
redis_url = "redis://localhost:6379"

# Permission system defaults and rules.
# Optional. Default:
# [permissions]
# default_effect = "allow"
# approval_ttl_seconds = 86400
# group_cache_ttl_seconds = 60
#
# Subject token format:
# - "user:<platform_user_id>" or "user:*"
# - "group:slack:<usergroup_id>"
# - "group:discord:<role_id>"
# - omit `actions` to apply a rule to all actions
#   (for effect="require_approval", omitted `actions` applies to all non-approval actions)
#
# Example:
# [permissions]
# default_effect = "allow"
# approval_ttl_seconds = 86400
# group_cache_ttl_seconds = 60
#
# [[permissions.rules]]
# id = "clear-before-requires-approval"
# effect = "require_approval"
# actions = ["jobs.clearBefore"]
# subjects = ["user:*"]
# approver_subjects = ["group:slack:S12345", "group:discord:987654321"]
# notify_subjects = ["group:slack:S12345", "group:discord:987654321"]
# providers = ["slack", "discord"]
# channel_ids = ["C123ABC", "123456789012345678"]

# Slack channel settings.
# Optional. Default: false.
[channels.slack]
# enabled = false

# Discord channel settings.
# Optional. Default: false.
[channels.discord]
# enabled = false

# Optional run action catalog for /<bot>-run.
# Keys are action ids and should match worker config and repo contracts.
#
# [run.actions.\"refresh-docs\"]
# label = "Refresh docs"
# description = "Rebuild documentation and publish artifacts"

[run.actions."db-migration-sanity"]
label = "DB migration sanity"
description = "Validate migration metadata and apply sqlite migrations against an isolated temporary DB path."

[run.actions."ci-check"]
label = "CI check"
description = "Run repository CI checks from worker fallback command."

[run.actions."promote-staging-to-main"]
label = "Promote staging to main"
description = "Create or reuse the GitHub PR that promotes staging into main."

# Discord app ID.
# Required when channels.discord.enabled = true.
# Optional otherwise. Example: "123456789012345678"
# app_id = "123456789012345678"

# Discord guild (server) ID.
# Optional. No default. Example: "123456789012345678"
# guild_id = "123456789012345678"

# Discord channel IDs to allow.
# Optional. Default: [] (empty). Example: ["123", "456"]
# Mentions/commands in threads are also allowed when the thread's parent channel ID is listed.
# channel_ids = ["123456789012345678"]
