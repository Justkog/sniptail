FROM node:22-bookworm-slim

RUN apt-get update && apt-get install -y --no-install-recommends \
    ca-certificates curl git openssh-client bash \
    ripgrep patch procps less \
  && rm -rf /var/lib/apt/lists/*

# non-root user
RUN useradd -m -s /bin/bash codex
USER codex
WORKDIR /home/codex

# Install global npm packages into the user home to avoid needing root.
ENV NPM_CONFIG_PREFIX=/home/codex/.npm-global
ENV PATH=/home/codex/.npm-global/bin:${PATH}
RUN npm install -g @openai/codex

ENTRYPOINT ["codex"]
